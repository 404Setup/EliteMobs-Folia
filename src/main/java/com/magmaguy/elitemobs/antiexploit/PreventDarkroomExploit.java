package com.magmaguy.elitemobs.antiexploit;

import com.magmaguy.elitemobs.api.AntiExploitEvent;
import com.magmaguy.elitemobs.config.AntiExploitConfig;
import com.magmaguy.elitemobs.utils.NonSolidBlockTypes;
import org.bukkit.entity.LivingEntity;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;

public class PreventDarkroomExploit implements Listener {

    @EventHandler
    public void onDamage(AntiExploitEvent event) {

        //gets blocks at 1 height completely surrounding the entity
        if (AntiExploitConfig.darkroomAntiexploit1)
            if (!NonSolidBlockTypes.isNonSolidBlock(event.block021) &&
                    !NonSolidBlockTypes.isNonSolidBlock(event.block120) &&
                    !NonSolidBlockTypes.isNonSolidBlock(event.block122) &&
                    !NonSolidBlockTypes.isNonSolidBlock(event.block221)) {
                event.getEliteMobEntity().setTriggeredAntiExploit(true);
                AntiExploitMessage.sendWarning((LivingEntity) event.getEntity(), "darkroom 1");
                return;
            }

        //gets blocks at 0 height plus if there's a block on top
        if (AntiExploitConfig.darkroomAntiexploit2)
            if ((!NonSolidBlockTypes.isNonSolidBlock(event.block011) || !NonSolidBlockTypes.isNonSolidBlock(event.block021)) &&
                    (!NonSolidBlockTypes.isNonSolidBlock(event.block110) || !NonSolidBlockTypes.isNonSolidBlock(event.block120)) &&
                    (!NonSolidBlockTypes.isNonSolidBlock(event.block112) || !NonSolidBlockTypes.isNonSolidBlock(event.block122)) &&
                    (!NonSolidBlockTypes.isNonSolidBlock(event.block211) || !NonSolidBlockTypes.isNonSolidBlock(event.block221)) &&
                    !NonSolidBlockTypes.isNonSolidBlock(event.ceilingMaterial)) {
                event.getEliteMobEntity().setTriggeredAntiExploit(true);
                AntiExploitMessage.sendWarning((LivingEntity) event.getEntity(), "darkroom 2");
                return;
            }

        darkRoomAntiExploit3(event);

    }

    private void darkRoomAntiExploit3(AntiExploitEvent event) {
        int wallCount = 0;
        if (!NonSolidBlockTypes.isNonSolidBlock(event.block011) && !NonSolidBlockTypes.isNonSolidBlock(event.block021))
            wallCount++;
        if (!NonSolidBlockTypes.isNonSolidBlock(event.block110) && !NonSolidBlockTypes.isNonSolidBlock(event.block120))
            wallCount++;
        if (!NonSolidBlockTypes.isNonSolidBlock(event.block112) && !NonSolidBlockTypes.isNonSolidBlock(event.block122))
            wallCount++;
        if (!NonSolidBlockTypes.isNonSolidBlock(event.block211) && !NonSolidBlockTypes.isNonSolidBlock(event.block221))
            wallCount++;

        if (wallCount >= 3)
            event.getEliteMobEntity().incrementAntiExploit(4, "darkroomantixploit3");
    }

}
